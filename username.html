<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>RecountPro ‚Äî –ü—Ä–æ—Ñ–∏–ª—å</title>
  <style>
    :root {
      --accent: #6d28d9;
      --accent-light: #a78bfa;
      --text: #1f2937;
      --border: #d1d5db;
      --bg: #0a0a0a;
      --card: #ffffff;
      --muted: #6b7280;
    }
    html, body {
      margin: 0; padding: 0;
      font-family: "Segoe UI", system-ui, sans-serif;
      color: var(--text);
      background: #f9fafb;
    }
    /* –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —à–∞–ø–∫–∞ */
    h1 {
      position: fixed;
      top: 0; left: 0; right: 0;
      z-index: 1001;
      background: var(--accent);
      color: #fff;
      padding: 1rem;
      margin: 0;
      font-size: 1.25rem;
      font-weight: 700;
      text-align: center;
    }
    /* –ö–æ–Ω—Ç–µ–Ω—Ç–Ω—ã–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä */
    .page {
      padding-top: 4.5rem; /* –ø–æ–¥ —à–∞–ø–∫—É */
      padding-bottom: 3rem;
      max-width: 860px;
      margin: 0 auto;
      padding-left: 1rem; padding-right: 1rem;
    }
    /* –ö–∞—Ä—Ç–æ—á–∫–∞ –ø—Ä–æ—Ñ–∏–ª—è */
    .card {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 12px;
      box-shadow: 0 8px 24px rgba(0,0,0,0.07);
      padding: 1rem;
    }
    .card h2 {
      margin: 0 0 0.75rem 0;
      font-size: 1.1rem;
    }
    .grid {
      display: grid;
      grid-template-columns: 1.2fr 0.8fr;
      gap: 1rem;
    }
    .field { margin-bottom: 0.75rem; }
    .label { font-weight: 600; font-size: 0.95rem; }
    .desc { font-size: 0.85rem; color: var(--muted); }
    input[type="text"], input[type="email"], input[type="file"], select, textarea {
      width: 100%;
      padding: 0.6rem;
      font-size: 1rem;
      border: 1px solid var(--border);
      border-radius: 8px;
      box-sizing: border-box;
      background: #fff;
    }
    textarea { min-height: 80px; resize: vertical; }
    .actions {
      display: flex; gap: 0.5rem; flex-wrap: wrap;
      margin-top: 0.75rem;
    }
    .btn {
      background: var(--accent);
      color: #fff;
      border: none;
      padding: 0.6rem 1rem;
      border-radius: 8px;
      font-size: 0.95rem;
      cursor: pointer;
      box-shadow: 0 2px 6px rgba(0,0,0,0.2);
    }
    .btn.secondary {
      background: #fff;
      color: var(--text);
      border: 1px solid var(--border);
    }
    .avatar {
      display: flex; align-items: center; gap: 1rem;
    }
    .avatar img {
      width: 120px; height: 120px;
      border-radius: 12px;
      object-fit: cover;
      border: 1px solid var(--border);
      background: #fff;
    }
    .switch {
      display: inline-flex; align-items: center; gap: 0.5rem;
    }
    .pill {
      display: inline-block;
      padding: 0.25rem 0.6rem;
      font-size: 0.8rem;
      border-radius: 999px;
      border: 1px solid var(--border);
      color: var(--muted);
      background: #fff;
    }
    .section {
      margin-top: 1rem;
      padding-top: 1rem;
      border-top: 1px dashed var(--border);
    }
  </style>
</head>
<body>
  <h1>RecountPro ‚Äî –ü—Ä–æ—Ñ–∏–ª—å</h1>
  <div class="page">
    <div class="card">
      <h2>–õ–∏—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ</h2>
      <div class="grid">
        <!-- –õ–µ–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞: –ø–æ–ª—è -->
        <div>
          <div class="field">
            <div class="label">–ò–º—è</div>
            <input type="text" id="firstName" placeholder="–ò–≤–∞–Ω" />
          </div>
          <div class="field">
            <div class="label">–§–∞–º–∏–ª–∏—è</div>
            <input type="text" id="lastName" placeholder="–ò–≤–∞–Ω–æ–≤" />
          </div>
          <div class="field">
            <div class="label">–î–æ–ª–∂–Ω–æ—Å—Ç—å</div>
            <input type="text" id="position" placeholder="–ö–ª–∞–¥–æ–≤—â–∏–∫ / –ú–µ–Ω–µ–¥–∂–µ—Ä / –†—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—å" />
          </div>
          <div class="field">
            <div class="label">Email</div>
            <input type="email" id="email" placeholder="you@example.com" />
          </div>
          <div class="field">
            <div class="label">–¢–µ–ª–µ—Ñ–æ–Ω</div>
            <input type="text" id="phone" placeholder="+7 (___) ___‚Äë__‚Äë__" />
          </div>
          <div class="field">
            <div class="label">–û —Å–µ–±–µ</div>
            <textarea id="bio" placeholder="–ö–æ—Ä–æ—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ, –ø—Ä–∏–º–µ—á–∞–Ω–∏—è –ø–æ —É—á—ë—Ç—É, –∑–æ–Ω–∞ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏..."></textarea>
          </div>

          <div class="section">
            <h2 style="margin:0 0 0.5rem 0; font-size:1rem;">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</h2>
            <div class="field">
              <label class="switch">
                <input type="checkbox" id="twoFA" />
                <span>–î–≤—É—Ö—Ñ–∞–∫—Ç–æ—Ä–Ω–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è</span>
              </label>
            </div>
            <div class="field">
              <label class="switch">
                <input type="checkbox" id="notify" />
                <span>–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ–± –∏—Ç–æ–≥–∞—Ö –ø–µ—Ä–µ—Å—á—ë—Ç–∞</span>
              </label>
            </div>
            <div class="field">
              <div class="label">–¢–µ–º–∞</div>
              <select id="theme">
                <option value="system">–°–∏—Å—Ç–µ–º–Ω–∞—è</option>
                <option value="light">–°–≤–µ—Ç–ª–∞—è</option>
                <option value="dark">–¢—ë–º–Ω–∞—è</option>
              </select>
            </div>
            <div class="actions">
              <button class="btn" id="saveProfile">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
              <button class="btn secondary" id="resetProfile">‚Ü∫ –°–±—Ä–æ—Å–∏—Ç—å</button>
              <span class="pill" id="saveStatus">–ù–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ</span>
            </div>
          </div>
        </div>

        <!-- –ü—Ä–∞–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞: —Ñ–æ—Ç–æ -->
        <div>
          <div class="label">–§–æ—Ç–æ –ø—Ä–æ—Ñ–∏–ª—è</div>
          <div class="avatar">
            <img id="avatarPreview" src="" alt="–§–æ—Ç–æ" />
            <div style="flex:1;">
              <input type="file" id="avatarFile" accept="image/*" />
              <div class="desc">–í—ã–±–µ—Ä–∏—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ. –ë—É–¥–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ –ª–æ–∫–∞–ª—å–Ω–æ.</div>
              <div class="actions" style="margin-top:0.5rem;">
                <button class="btn secondary" id="removeAvatar">üóë –£–¥–∞–ª–∏—Ç—å —Ñ–æ—Ç–æ</button>
                <button class="btn secondary" id="downloadVCard">üì• vCard</button>
              </div>
            </div>
          </div>

          <div class="section">
            <h2 style="margin:0 0 0.5rem 0; font-size:1rem;">–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å</h2>
            <div class="field">
              <div class="label">–°–º–µ–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å</div>
              <input type="text" id="newPassword" placeholder="–ù–æ–≤—ã–π –ø–∞—Ä–æ–ª—å" />
              <div class="desc">–ü–∞—Ä–æ–ª—å —Ö—Ä–∞–Ω–∏—Ç—Å—è –Ω–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ. –ó–¥–µ—Å—å ‚Äî —Ç–æ–ª—å–∫–æ –æ—Ç–ø—Ä–∞–≤–∫–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä (–∑–∞–≥–ª—É—à–∫–∞).</div>
              <div class="actions">
                <button class="btn secondary" id="changePassword">üîí –°–º–µ–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å</button>
              </div>
            </div>
          </div>

        </div>
      </div>
    </div>
    <div class="section card" style="margin-top:1rem;">
      <h2>–ü—Ä–æ—Ñ–∏–ª—å ‚Äî –¥–µ–π—Å—Ç–≤–∏—è</h2>
      <div class="actions">
        <button class="btn" id="goRecount">üì¶ –ü–µ—Ä–µ—Å—á—ë—Ç</button>
        <button class="btn secondary" id="logout">üö™ –í—ã–π—Ç–∏</button>
      </div>
      <div class="desc" style="margin-top:0.5rem;">
        –ü–æ—Å–ª–µ –≤—ã—Ö–æ–¥–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è. –ü—Ä–∏ –±–µ–∑–¥–µ–π—Å—Ç–≤–∏–∏ –±–æ–ª–µ–µ 6 —á–∞—Å–æ–≤ ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—ã—Ö–æ–¥.
      </div>
    </div>
  </div>
<script>
  // –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –∏ —Ç–∞–π–º–∞—É—Ç –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
  const LAST_ACTIVITY_KEY = "lastActivity";
  const MAX_IDLE_TIME = 6 * 60 * 60 * 1000; // 6 —á–∞—Å–æ–≤
  const isAuth = localStorage.getItem("isAuth");

  if (isAuth !== "true") {
    window.location.href = "/login.html";
  }

  function updateActivity() {
    localStorage.setItem(LAST_ACTIVITY_KEY, Date.now().toString());
  }
  function checkIdleTime() {
    const last = parseInt(localStorage.getItem(LAST_ACTIVITY_KEY) || "0", 10);
    const now = Date.now();
    if (last && now - last > MAX_IDLE_TIME) {
      localStorage.removeItem("isAuth");
      window.location.href = "/login.html";
    }
  }
  ["click","keydown","mousemove","scroll","touchstart"].forEach(evt => {
    document.addEventListener(evt, updateActivity, { passive: true });
  });
  setInterval(checkIdleTime, 60 * 1000);
  updateActivity();

  // –≠–ª–µ–º–µ–Ω—Ç—ã
  const $ = id => document.getElementById(id);
  const fields = ["firstName","lastName","position","email","phone","bio","twoFA","notify","theme"];
  const avatarPreview = $("avatarPreview");
  const avatarFile = $("avatarFile");
  const saveStatus = $("saveStatus");

  // –ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–æ—Ñ–∏–ª—è –∏–∑ localStorage
  function loadProfile() {
    const raw = localStorage.getItem("profile");
    if (!raw) return;
    try {
      const p = JSON.parse(raw);
      $("firstName").value = p.firstName || "";
      $("lastName").value = p.lastName || "";
      $("position").value = p.position || "";
      $("email").value = p.email || "";
      $("phone").value = p.phone || "";
      $("bio").value = p.bio || "";
      $("twoFA").checked = !!p.twoFA;
      $("notify").checked = !!p.notify;
      $("theme").value = p.theme || "system";
      if (p.avatar) avatarPreview.src = p.avatar; else avatarPreview.removeAttribute("src");
      applyTheme(p.theme || "system");
      saveStatus.textContent = "–ó–∞–≥—Ä—É–∂–µ–Ω–æ";
    } catch {
      saveStatus.textContent = "–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏";
    }
  }

  // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è –≤ localStorage
  function saveProfile() {
    const p = {
      firstName: $("firstName").value.trim(),
      lastName: $("lastName").value.trim(),
      position: $("position").value.trim(),
      email: $("email").value.trim(),
      phone: $("phone").value.trim(),
      bio: $("bio").value.trim(),
      twoFA: $("twoFA").checked,
      notify: $("notify").checked,
      theme: $("theme").value,
      avatar: avatarPreview.src || ""
    };
    localStorage.setItem("profile", JSON.stringify(p));
    saveStatus.textContent = "–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ";
  }

  // –°–±—Ä–æ—Å –ø—Ä–æ—Ñ–∏–ª—è (—Ç–æ–ª—å–∫–æ –ª–æ–∫–∞–ª—å–Ω–æ)
  function resetProfile() {
    if (!confirm("–°–±—Ä–æ—Å–∏—Ç—å –ª–æ–∫–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø—Ä–æ—Ñ–∏–ª—è?")) return;
    localStorage.removeItem("profile");
    fields.forEach(f => {
      if (["twoFA","notify"].includes(f)) $(f).checked = false;
      else if (f === "theme") $(f).value = "system";
      else $(f).value = "";
    });
    avatarPreview.removeAttribute("src");
    saveStatus.textContent = "–°–±—Ä–æ—à–µ–Ω–æ";
  }

  // –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏ –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä
  avatarFile.addEventListener("change", async e => {
    const file = e.target.files[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = () => {
      avatarPreview.src = reader.result;
      saveStatus.textContent = "–§–æ—Ç–æ –∑–∞–≥—Ä—É–∂–µ–Ω–æ (–Ω–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ)";
    };
    reader.readAsDataURL(file);
  });
  $("removeAvatar").addEventListener("click", () => {
    avatarPreview.removeAttribute("src");
    avatarFile.value = "";
    saveStatus.textContent = "–§–æ—Ç–æ —É–¥–∞–ª–µ–Ω–æ (–Ω–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ)";
  });

  // vCard –≥–µ–Ω–µ—Ä–∞—Ü–∏—è (—Å–∫–∞—á–∞—Ç—å .vcf)
  $("downloadVCard").addEventListener("click", () => {
    const first = $("firstName").value.trim();
    const last = $("lastName").value.trim();
    const email = $("email").value.trim();
    const phone = $("phone").value.trim();
    const title = $("position").value.trim();
    const vcf = [
      "BEGIN:VCARD",
      "VERSION:3.0",
      `N:${last};${first};;;`,
      `FN:${first} ${last}`.trim(),
      title ? `TITLE:${title}` : "",
      email ? `EMAIL;TYPE=INTERNET:${email}` : "",
      phone ? `TEL;TYPE=CELL:${phone}` : "",
      "END:VCARD"
    ].filter(Boolean).join("\n");
    const blob = new Blob([vcf], { type: "text/vcard;charset=utf-8" });
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = `recountpro_${first || "user"}_${last || "profile"}.vcf`;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
  });

  // –¢–µ–º–∞
  function applyTheme(theme) {
    if (theme === "dark") {
      document.documentElement.style.background = "#0b0b0c";
      document.body.style.background = "#0b0b0c";
      document.body.style.color = "#e5e7eb";
    } else if (theme === "light") {
      document.documentElement.style.background = "#f9fafb";
      document.body.style.background = "#f9fafb";
      document.body.style.color = varText();
    } else {
      document.documentElement.removeAttribute("style");
      document.body.removeAttribute("style");
    }
  }
  function varText(){ return getComputedStyle(document.documentElement).getPropertyValue('--text'); }
  $("theme").addEventListener("change", e => {
    applyTheme(e.target.value);
    saveStatus.textContent = "–¢–µ–º–∞ –∏–∑–º–µ–Ω–µ–Ω–∞ (–Ω–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ)";
  });

  // –ù–∞–≤–∏–≥–∞—Ü–∏—è –∏ –≤—ã—Ö–æ–¥
  $("goRecount").addEventListener("click", () => {
    updateActivity();
    window.location.href = "/recount.html";
  });
  $("logout").addEventListener("click", () => {
    if (!confirm("–í—ã–π—Ç–∏ –∏–∑ –∞–∫–∫–∞—É–Ω—Ç–∞?")) return;
    localStorage.removeItem("isAuth");
    window.location.href = "/login.html";
  });

  // –°–º–µ–Ω–∞ –ø–∞—Ä–æ–ª—è (–∑–∞–≥–ª—É—à–∫–∞)
  $("changePassword").addEventListener("click", () => {
    const newPass = $("newPassword").value.trim();
    if (!newPass) return alert("–í–≤–µ–¥–∏—Ç–µ –Ω–æ–≤—ã–π –ø–∞—Ä–æ–ª—å");
    // –ó–¥–µ—Å—å –±—ã–ª –±—ã –∑–∞–ø—Ä–æ—Å –∫ —Å–µ—Ä–≤–µ—Ä—É. –ü–æ–∫–∞ –ø—Ä–æ—Å—Ç–æ –∏–Ω—Ñ–æ—Ä–º–∏—Ä—É–µ–º:
    alert("–ó–∞–ø—Ä–æ—Å –Ω–∞ —Å–º–µ–Ω—É –ø–∞—Ä–æ–ª—è –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω (–∑–∞–≥–ª—É—à–∫–∞)");
    $("newPassword").value = "";
  });

  // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ/—Å–±—Ä–æ—Å
  $("saveProfile").addEventListener("click", saveProfile);
  $("resetProfile").addEventListener("click", resetProfile);

  // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
  loadProfile();
</script>
</body>
</html>
