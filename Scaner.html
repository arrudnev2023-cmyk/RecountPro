<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Table Extractor (Tesseract only)</title>

  <script src="https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js"></script>

  <style>
    body { font-family: sans-serif; padding: 20px; }
    #preview { max-width: 100%; margin-top: 10px; display: block; }
    table { border-collapse: collapse; margin-top: 20px; width: 100%; }
    td, th { border: 1px solid #ccc; padding: 4px; font-size: 12px; }
    #loader { margin-top: 10px; font-size: 14px; color: #555; }
  </style>
</head>
<body>

<h2>üìÑ Table Extractor (–±–µ–∑ —Å–µ—Ä–≤–µ—Ä–∞)</h2>

<input type="file" id="fileInput" accept="image/*">
<div id="loader"></div>
<img id="preview">
<div id="result"></div>

<script>
const fileInput = document.getElementById("fileInput");
const loader = document.getElementById("loader");
const preview = document.getElementById("preview");
const result = document.getElementById("result");

fileInput.addEventListener("change", async (e) => {
  const file = e.target.files[0];
  if (!file) return;

  result.innerHTML = "";
  loader.textContent = "–ó–∞–≥—Ä—É–∂–∞—é —Ñ–æ—Ç–æ...";

  preview.src = URL.createObjectURL(file);

  preview.onload = async () => {
    loader.textContent = "–†–∞—Å–ø–æ–∑–Ω–∞—é —Ç–µ–∫—Å—Ç...";
    try {
      const { data } = await Tesseract.recognize(preview, "rus+eng", {
        tessedit_pageseg_mode: 6
      });
      loader.textContent = "";
      const rows = buildTableFromLines(data);
      renderTable(rows);
    } catch (err) {
      console.error(err);
      loader.textContent = "–û—à–∏–±–∫–∞ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è";
    }
  };
});

function buildTableFromLines(data) {
  if (!data || !data.lines) return [];

  // –ë–µ—Ä—ë–º —Ç–æ–ª—å–∫–æ —Å—Ç—Ä–æ–∫–∏, –≥–¥–µ –µ—Å—Ç—å —Ö–æ—Ç—å –∫–∞–∫–æ–π‚Äë—Ç–æ —Ç–µ–∫—Å—Ç
  const lines = data.lines.filter(l => l.text && l.text.trim().length > 0);

  const rows = lines.map(line => {
    // –†–∞–∑–±–∏–≤–∞–µ–º —Å—Ç—Ä–æ–∫—É –Ω–∞ —Å–ª–æ–≤–∞ ‚Äî —ç—Ç–æ –±—É–¥—É—Ç —è—á–µ–π–∫–∏
    const words = line.text
      .replace(/\s+/g, " ")
      .trim()
      .split(" ");
    return words;
  });

  return rows;
}

function renderTable(rows) {
  if (!rows.length) {
    result.innerHTML = "–¢–∞–±–ª–∏—Ü–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞";
    return;
  }

  let html = "<table>";
  rows.forEach(row => {
    html += "<tr>";
    row.forEach(cell => {
      html += `<td contenteditable="true">${cell || ""}</td>`;
    });
    html += "</tr>";
  });
  html += "</table>";

  result.innerHTML = html;
}
</script>

</body>
</html>
