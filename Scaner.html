<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>CodeStep — генератор кода</title>
  <!-- Подключаем библиотеки для zip и сохранения -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
  <style>
    body{font-family:system-ui,sans-serif;background:#0b0e13;color:#f0f2f7;margin:0;padding:20px}
    h1{margin-bottom:10px}
    label{display:block;margin-top:10px;font-size:14px;color:#a9afbf}
    input,select,textarea{width:100%;padding:8px;margin-top:4px;border-radius:8px;border:1px solid #444;background:#1a1d24;color:#fff}
    button{margin-top:12px;padding:10px 14px;border-radius:8px;border:0;cursor:pointer;font-weight:600}
    .primary{background:linear-gradient(180deg,#85a9ff,#6f8df1);color:#081021}
    .code{margin-top:20px;padding:12px;background:#1a1d24;border-radius:8px;white-space:pre;overflow:auto}
  </style>
</head>
<body>
  <h1>CodeStep — генератор кода</h1>

  <label>Цель программы</label>
  <input id="goal" placeholder="Например: API заметок" />

  <label>Язык</label>
  <select id="lang">
    <option value="node">Node.js (Fastify)</option>
    <option value="python">Python (FastAPI)</option>
    <option value="frontend">Frontend (HTML+JS)</option>
  </select>

  <button class="primary" id="generate">Сгенерировать код</button>
  <button id="download" style="display:none">Скачать проект.zip</button>

  <div class="code" id="codeBox">// Здесь появится код</div>

  <script>
    const goal=document.getElementById("goal");
    const lang=document.getElementById("lang");
    const codeBox=document.getElementById("codeBox");
    const genBtn=document.getElementById("generate");
    const dlBtn=document.getElementById("download");

    let files=[];

    function buildProject(){
      const title=goal.value||"Demo проект";
      if(lang.value==="node"){
        files=[
          {name:"package.json",content:`{
  "name":"demo",
  "version":"1.0.0",
  "scripts":{"start":"node server.js"},
  "dependencies":{"fastify":"^4.26.2"}
}`},
          {name:"server.js",content:`import Fastify from "fastify";
const app=Fastify();
app.get("/",async()=>({hello:"world"}));
app.listen({port:3000});`}
        ];
      } else if(lang.value==="python"){
        files=[
          {name:"requirements.txt",content:`fastapi\nuvicorn`},
          {name:"main.py",content:`from fastapi import FastAPI
app=FastAPI()
@app.get("/")
def root(): return {"hello":"world"}`}
        ];
      } else {
        files=[
          {name:"index.html",content:`<!DOCTYPE html><html><body><h1>${title}</h1><script>document.body.append(" Hello World")</script></body></html>`}
        ];
      }
      // README теперь берёт название из поля
      files.unshift({name:"README.md",content:`# ${title}\n\nСгенерировано CodeStep`});
    }

    genBtn.onclick=()=>{
      buildProject();
      codeBox.textContent=files.map(f=>`/* ==== ${f.name} ==== */\n${f.content}`).join("\n\n");
      dlBtn.style.display="inline-block";
    };

    dlBtn.onclick=()=>{
      const zip=new JSZip();
      files.forEach(f=>zip.file(f.name,f.content));
      zip.generateAsync({type:"blob"}).then(content=>{
        saveAs(content,"project.zip");
      });
    };
  </script>
</body>
</html>
