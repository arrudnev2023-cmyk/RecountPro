<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>CSV → JSON (barcode → name)</title>
<style>
    body { font-family: sans-serif; padding: 40px; max-width: 700px; margin: auto; }
    textarea { width: 100%; height: 300px; margin-top: 20px; }
    .btn { padding: 10px 20px; background: #007aff; color: white; border: none; cursor: pointer; border-radius: 6px; }
    .btn:hover { background: #005fcc; }
</style>
</head>
<body>

<h2>CSV → JSON конвертер (barcode → name)</h2>
<p>Загрузи CSV с двумя столбцами: <b>Название, Штрихкод</b> (Numbers/Excel)</p>

<input type="file" id="fileInput" accept=".csv">
<button class="btn" onclick="convert()">Конвертировать</button>

<h3>Результат JSON (словарь):</h3>
<textarea id="output"></textarea>

<script>
function convert() {
    const file = document.getElementById('fileInput').files[0];
    if (!file) {
        alert("Выбери CSV файл");
        return;
    }

    const reader = new FileReader();
    reader.onload = function(e) {
        let text = e.target.result;
        if (!text) {
            alert("Пустой файл");
            return;
        }

        // Убираем BOM и лишние пробелы по краям
        text = text.replace(/^\uFEFF/, "").trim();

        const lines = text.split(/\r?\n/).filter(l => l.trim() !== "");
        if (lines.length === 0) {
            alert("Нет строк в файле");
            return;
        }

        // Определяем разделитель: , или ;
        let delimiter = ",";
        const firstLine = lines[0];
        const commaCount = (firstLine.match(/,/g) || []).length;
        const semicolonCount = (firstLine.match(/;/g) || []).length;
        if (semicolonCount > commaCount) {
            delimiter = ";";
        }

        const result = {};

        for (let rawLine of lines) {
            const line = rawLine.trim();
            if (!line) continue;

            const idx = line.lastIndexOf(delimiter);
            if (idx === -1) continue;

            const name = line.slice(0, idx).trim();
            const barcode = line.slice(idx + 1).trim();

            if (name && barcode) {
                result[barcode] = name;
            }
        }

        document.getElementById('output').value = JSON.stringify(result, null, 2);
    };

    reader.readAsText(file, "UTF-8");
}
</script>

</body>
</html>
