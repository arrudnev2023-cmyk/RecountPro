<!DOCTYPE html>
<html lang="ru">
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>True Skate Web++</title>
<style>
  body, html {
    margin: 0;
    padding: 0;
    overflow: hidden;
    background: #111;
    touch-action: none;
  }
  canvas {
    display: block;
    background: #111;
  }
</style>
</head>
<body>

<canvas id="game"></canvas>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

function resize() {
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
}
resize();
window.addEventListener("resize", resize);

// ----------------------
// ПАРАМЕТРЫ СКЕЙТА
// ----------------------
let board = {
  x: canvas.width / 2,
  y: canvas.height * 0.7,
  vx: 0,
  vy: 0,
  vz: 0,        // вертикальный прыжок
  z: 0,         // высота над землей
  angle: 0,     // вращение по вертикали
  flip: 0,      // вращение для флипов
  width: 160,
  height: 40,
  tilt: 0
};

let friction = 0.96;
let gravity = 0.6;

// ----------------------
// РАМПА
// ----------------------
let ramp = {
  x: canvas.width * 0.15,
  y: canvas.height * 0.75,
  width: canvas.width * 0.7,
  height: 120
};

// ----------------------
// СВАЙПЫ
// ----------------------
let touchStart = null;

canvas.addEventListener("touchstart", e => {
  const t = e.touches[0];
  touchStart = { x: t.clientX, y: t.clientY };
});

canvas.addEventListener("touchend", e => {
  if (!touchStart) return;

  const t = e.changedTouches[0];
  const dx = t.clientX - touchStart.x;
  const dy = t.clientY - touchStart.y;

  // ----------------------
  // ТРЮКИ
  // ----------------------

  // ОЛЛИ (сильный свайп вверх)
  if (dy < -40 && Math.abs(dx) < 40) {
    board.vz = 12;
  }

  // КИКФЛИП (вправо + вверх)
  if (dy < -40 && dx > 40) {
    board.vz = 10;
    board.flip = 0.25;
  }

  // ХИЛФЛИП (влево + вверх)
  if (dy < -40 && dx < -40) {
    board.vz = 10;
    board.flip = -0.25;
  }

  // Обычное движение
  board.vx += dx * 0.05;
  board.vy += dy * 0.02;

  // Наклон доски
  board.tilt = dx * 0.002;

  touchStart = null;
});

// ----------------------
// ФИЗИКА
// ----------------------
function update() {
  // Горизонтальное движение
  board.x += board.vx;
  board.vx *= friction;

  // Вертикальная позиция (вперед-назад)
  board.y = canvas.height * 0.7;

  // Прыжок
  board.z += board.vz;
  board.vz -= gravity;

  // Приземление
  if (board.z < 0) {
    board.z = 0;
    board.vz = 0;
    board.flip = 0;
  }

  // Вращение доски в воздухе
  if (board.z > 0) {
    board.angle += board.flip;
  }

  // Наклон возвращается
  board.tilt *= 0.9;

  // Границы
  const margin = 40;
  if (board.x < margin) board.x = margin;
  if (board.x > canvas.width - margin) board.x = canvas.width - margin;

  // ----------------------
  // РАМПА — подъём
  // ----------------------
  if (board.x > ramp.x && board.x < ramp.x + ramp.width) {
    let t = (board.x - ramp.x) / ramp.width;
    let rampHeight = Math.sin(t * Math.PI) * ramp.height;

    if (board.z === 0) {
      board.y = canvas.height * 0.7 - rampHeight;
    }
  }
}

// ----------------------
// ОТРИСОВКА РАМПЫ
// ----------------------
function drawRamp() {
  ctx.fillStyle = "#222";
  ctx.beginPath();
  ctx.moveTo(ramp.x, ramp.y);
  ctx.quadraticCurveTo(
    ramp.x + ramp.width / 2,
    ramp.y - ramp.height,
    ramp.x + ramp.width,
    ramp.y
  );
  ctx.lineTo(ramp.x + ramp.width, canvas.height);
  ctx.lineTo(ramp.x, canvas.height);
  ctx.closePath();
  ctx.fill();
}

// ----------------------
// ОТРИСОВКА СКЕЙТА
// ----------------------
function drawBoard() {
  ctx.save();
  ctx.translate(board.x, board.y - board.z);
  ctx.rotate(board.tilt + board.angle);

  // Тень
  ctx.fillStyle = "rgba(0,0,0,0.4)";
  ctx.beginPath();
  ctx.ellipse(0, 20, board.width * 0.5, 12, 0, 0, Math.PI * 2);
  ctx.fill();

  // Дека
  const r = board.height / 2;
  const len = board.width - board.height;

  ctx.fillStyle = "#f5a623";
  ctx.beginPath();
  ctx.moveTo(-len/2, -r);
  ctx.lineTo(len/2, -r);
  ctx.arc(len/2, 0, r, -Math.PI/2, Math.PI/2);
  ctx.lineTo(-len/2, r);
  ctx.arc(-len/2, 0, r, Math.PI/2, -Math.PI/2);
  ctx.closePath();
  ctx.fill();

  ctx.strokeStyle = "#b36b00";
  ctx.lineWidth = 3;
  ctx.stroke();

  ctx.restore();
}

// ----------------------
// ГЛАВНЫЙ ЦИКЛ
// ----------------------
function loop() {
  update();

  ctx.clearRect(0, 0, canvas.width, canvas.height);

  drawRamp();
  drawBoard();

  requestAnimationFrame(loop);
}
loop();
</script>

</body>
</html>
