<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Table Extractor (Mobile)</title>

  <script src="https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js"></script>

  <style>
    body { font-family: sans-serif; padding: 20px; }
    #preview { max-width: 100%; margin-top: 20px; display: block; }
    table { border-collapse: collapse; margin-top: 20px; width: 100%; }
    td { border: 1px solid #ccc; padding: 6px; font-size: 14px; }
  </style>
</head>
<body>

<h2>üìÑ Table Extractor (Mobile)</h2>

<input type="file" id="fileInput" accept="image/*">
<img id="preview">
<div id="result"></div>

<script>
document.getElementById("fileInput").addEventListener("change", async (e) => {
  const file = e.target.files[0];
  if (!file) return;

  const img = document.getElementById("preview");
  img.src = URL.createObjectURL(file);

  img.onload = async () => {
    document.getElementById("result").innerHTML = "–û–±—Ä–∞–±–æ—Ç–∫–∞...";
    const table = await extractTable(img);
    renderTable(table);
  };
});

async function extractTable(img) {
  const rowsCount = 12;   // –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç—Ä–æ–∫
  const colsCount = 6;    // –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–æ–ª–æ–Ω–æ–∫

  const canvas = document.createElement("canvas");
  const ctx = canvas.getContext("2d");

  canvas.width = img.width;
  canvas.height = img.height;

  ctx.drawImage(img, 0, 0);

  const cellWidth = canvas.width / colsCount;
  const cellHeight = canvas.height / rowsCount;

  let table = [];

  for (let r = 0; r < rowsCount; r++) {
    let row = [];
    for (let c = 0; c < colsCount; c++) {
      const cellCanvas = document.createElement("canvas");
      const cellCtx = cellCanvas.getContext("2d");

      cellCanvas.width = cellWidth;
      cellCanvas.height = cellHeight;

      cellCtx.drawImage(
        canvas,
        c * cellWidth,
        r * cellHeight,
        cellWidth,
        cellHeight,
        0,
        0,
        cellWidth,
        cellHeight
      );

      const text = await ocrCell(cellCanvas);
      row.push(text);
    }
    table.push(row);
  }

  return table;
}

async function ocrCell(canvas) {
  const { data: { text } } = await Tesseract.recognize(canvas, "rus+eng", {
    tessedit_pageseg_mode: 6
  });
  return text.trim();
}

function renderTable(rows) {
  let html = "<table>";

  rows.forEach(row => {
    html += "<tr>";
    row.forEach(cell => {
      html += `<td contenteditable="true">${cell}</td>`;
    });
    html += "</tr>";
  });

  html += "</table>";
  document.getElementById("result").innerHTML = html;
}
</script>

</body>
</html>
