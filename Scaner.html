<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <title>LuxTasks — премиальный список дел</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root{
      --bg:#0b0f18;
      --panel:rgba(255,255,255,0.08);
      --panel-strong:rgba(255,255,255,0.12);
      --glass:rgba(255,255,255,0.06);
      --blur: 16px;
      --text:#e6eaf2;
      --muted:#9aa6b2;
      --accent:#6a11cb;
      --accent-2:#2575fc;
      --success:#22c55e;
      --danger:#ef4444;
      --warning:#f59e0b;
      --border:rgba(255,255,255,0.18);
      --shadow: 0 20px 40px rgba(0,0,0,0.35);
    }
    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0;
      font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "SF Pro Text", Arial;
      color: var(--text);
      background:
        radial-gradient(1200px 800px at 10% 10%, #0e1422 0%, #0b0f18 60%, #0a0e17 100%),
        linear-gradient(135deg, rgba(38,83,240,0.2), rgba(106,17,203,0.2));
    }
    .app {
      max-width: 920px;
      margin: 0 auto;
      padding: 18px;
    }
    .header {
      display: flex; align-items: center; justify-content: space-between;
      padding: 14px 16px;
      background: var(--glass);
      backdrop-filter: blur(var(--blur)) saturate(130%);
      border: 1px solid var(--border);
      border-radius: 16px;
      box-shadow: var(--shadow);
    }
    .brand {
      display:flex; align-items:center; gap:12px;
    }
    .logo {
      width: 36px; height: 36px; border-radius: 12px;
      background: linear-gradient(135deg, var(--accent), var(--accent-2));
      box-shadow: 0 8px 20px rgba(99,102,241,0.45);
    }
    .title {
      font-weight: 700; letter-spacing: 0.2px;
    }
    .subtitle {
      font-size: 12px; color: var(--muted);
    }
    .actions { display:flex; gap:10px; }
    .btn {
      appearance: none; border: 1px solid var(--border);
      background: var(--panel);
      color: var(--text);
      padding: 8px 12px; border-radius: 12px;
      cursor: pointer;
      transition: transform .15s ease, box-shadow .15s ease, background .15s;
    }
    .btn:hover { transform: translateY(-1px); background: var(--panel-strong); box-shadow: 0 8px 20px rgba(0,0,0,0.25); }
    .btn:active { transform: translateY(0); }
    .btn.primary {
      background: linear-gradient(135deg, var(--accent), var(--accent-2));
      border: none;
      box-shadow: 0 12px 28px rgba(37,117,252,0.35);
    }
    .grid {
      margin-top: 16px;
      display: grid; gap: 16px;
      grid-template-columns: 1fr;
    }
    @media (min-width: 860px) {
      .grid { grid-template-columns: 2fr 1fr; }
    }
    .card {
      background: var(--glass); backdrop-filter: blur(var(--blur)) saturate(130%);
      border: 1px solid var(--border);
      border-radius: 16px; padding: 16px;
      box-shadow: var(--shadow);
    }
    .card h2 {
      margin: 0 0 12px; font-size: 16px; letter-spacing: .2px;
    }
    .inputs { display:grid; gap:10px; grid-template-columns: 1fr 120px 140px auto; }
    @media (max-width: 640px) {
      .inputs { grid-template-columns: 1fr 110px 130px; }
      .inputs .btn { grid-column: 1 / -1; }
    }
    .input {
      width: 100%; border: 1px solid var(--border); border-radius: 12px;
      padding: 10px 12px; background: rgba(255,255,255,0.05); color: var(--text);
      caret-color: var(--accent);
      transition: border-color .15s ease, box-shadow .15s ease, background .15s ease;
    }
    .input::placeholder { color: #a8b3c1; }
    .input:focus {
      outline: none; border-color: rgba(37,117,252,0.7);
      box-shadow: 0 0 0 4px rgba(37,117,252,0.15);
      background: rgba(255,255,255,0.08);
    }
    .toolbar { display:flex; gap:10px; margin-top: 12px; }
    .filter { flex:1; }
    .select {
      width: 100%; border: 1px solid var(--border); border-radius: 12px;
      padding: 10px 12px; background: rgba(255,255,255,0.05); color: var(--text);
    }
    .list { display:flex; flex-direction: column; gap: 8px; margin-top: 12px; }
    .item {
      position: relative;
      display:grid; grid-template-columns: 1fr auto auto;
      gap: 12px; align-items: center;
      padding: 12px; border-radius: 12px;
      border: 1px solid var(--border);
      background: rgba(255,255,255,0.06);
      transition: transform .12s ease, background .15s ease, border-color .15s ease;
    }
    .item:hover { transform: translateY(-1px); background: rgba(255,255,255,0.09); }
    .item.done { opacity: .78; }
    .item-title { font-weight: 600; }
    .item-meta { font-size: 12px; color: var(--muted); }
    .priority {
      padding: 6px 10px; border-radius: 999px; font-size: 12px; border: 1px solid var(--border);
      background: rgba(255,255,255,0.07);
    }
    .priority.low    { color:#8bd4a7; }
    .priority.medium { color:#ffd27a; }
    .priority.high   { color:#ff9aa2; }
    .item-actions { display:flex; gap:8px; }
    .chip {
      font-size: 11px; color: var(--muted);
      border: 1px dashed var(--border); border-radius: 999px;
      padding: 6px 10px;
    }
    .stat {
      display:grid; grid-template-columns: 1fr 1fr 1fr; gap: 12px;
      margin-top: 10px;
    }
    .stat .box {
      padding: 12px; border-radius: 12px; border: 1px solid var(--border);
      background: rgba(255,255,255,0.06);
      text-align: center;
    }
    .box .num { font-size: 18px; font-weight: 700; }
    .box .lbl { font-size: 12px; color: var(--muted); }
    .footer {
      margin-top: 16px; font-size: 12px; color: var(--muted);
      display:flex; justify-content: space-between; align-items:center;
    }
    .kbd {
      border:1px solid var(--border); border-bottom-width: 3px;
      padding: 2px 6px; border-radius: 8px; background: rgba(255,255,255,0.06);
      font-size: 11px;
    }
    .hidden { display:none !important; }
    .inline-edit {
      border: none; background: transparent; color: var(--text);
      width: 100%;
    }
    .inline-edit:focus { outline: none; }
  </style>
</head>
<body>
  <div class="app">
    <div class="header">
      <div class="brand">
        <div class="logo"></div>
        <div>
          <div class="title">LuxTasks</div>
          <div class="subtitle">Минималистичный премиальный список дел</div>
        </div>
      </div>
      <div class="actions">
        <button class="btn" id="btnExport">Экспорт JSON</button>
        <button class="btn" id="btnImport">Импорт JSON</button>
        <button class="btn primary" id="btnClear">Очистить</button>
      </div>
    </div>

    <div class="grid">
      <div class="card">
        <h2>Добавить задачу</h2>
        <div class="inputs">
          <input id="taskTitle" class="input" type="text" placeholder="Заголовок задачи" />
          <select id="taskPriority" class="select" title="Приоритет">
            <option value="low">Низкий</option>
            <option value="medium" selected>Средний</option>
            <option value="high">Высокий</option>
          </select>
          <input id="taskTags" class="input" type="text" placeholder="Теги через запятую" />
          <button id="btnAdd" class="btn">Добавить</button>
        </div>

        <div class="toolbar">
          <input id="search" class="input filter" type="text" placeholder="Поиск по заголовку или тегам…" />
          <select id="filterPriority" class="select" title="Фильтр по приоритету">
            <option value="all" selected>Все приоритеты</option>
            <option value="low">Низкий</option>
            <option value="medium">Средний</option>
            <option value="high">Высокий</option>
          </select>
        </div>

        <div class="list" id="taskList"></div>

        <div class="stat">
          <div class="box">
            <div class="num" id="statTotal">0</div>
            <div class="lbl">Всего задач</div>
          </div>
          <div class="box">
            <div class="num" id="statDone">0</div>
            <div class="lbl">Выполнено</div>
          </div>
          <div class="box">
            <div class="num" id="statHigh">0</div>
            <div class="lbl">Высокий приоритет</div>
          </div>
        </div>
      </div>

      <div class="card">
        <h2>Быстрые заметки</h2>
        <div style="display:grid; gap:10px;">
          <textarea id="notes" class="input" rows="8" placeholder="Любые мысли, идеи, чек‑лист..."></textarea>
          <div style="display:flex; gap:10px;">
            <button class="btn" id="btnCopyNotes">Копировать</button>
            <button class="btn" id="btnClearNotes">Очистить</button>
          </div>
        </div>

        <div class="footer">
          <div>
            Сохранение локально. Горячие клавиши:
            <span class="kbd">Enter</span> — добавить,
            <span class="kbd">⌘/Ctrl + K</span> — поиск.
          </div>
          <div id="status" aria-live="polite">Готово</div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Модель
    const storeKey = 'luxtasks.v1';
    let tasks = loadTasks();
    let notes = localStorage.getItem('luxtasks.notes') || '';

    // DOM
    const el = {
      list: document.getElementById('taskList'),
      title: document.getElementById('taskTitle'),
      priority: document.getElementById('taskPriority'),
      tags: document.getElementById('taskTags'),
      add: document.getElementById('btnAdd'),
      search: document.getElementById('search'),
      filterPriority: document.getElementById('filterPriority'),
      statTotal: document.getElementById('statTotal'),
      statDone: document.getElementById('statDone'),
      statHigh: document.getElementById('statHigh'),
      btnExport: document.getElementById('btnExport'),
      btnImport: document.getElementById('btnImport'),
      btnClear: document.getElementById('btnClear'),
      notes: document.getElementById('notes'),
      btnCopyNotes: document.getElementById('btnCopyNotes'),
      btnClearNotes: document.getElementById('btnClearNotes'),
      status: document.getElementById('status')
    };

    // Инициализация
    el.notes.value = notes;
    render();

    // События
    el.add.addEventListener('click', onAdd);
    el.title.addEventListener('keydown', e => { if (e.key === 'Enter') onAdd(); });
    el.search.addEventListener('input', render);
    el.filterPriority.addEventListener('change', render);
    el.btnExport.addEventListener('click', onExport);
    el.btnImport.addEventListener('click', onImport);
    el.btnClear.addEventListener('click', onClear);
    el.notes.addEventListener('input', () => {
      localStorage.setItem('luxtasks.notes', el.notes.value || '');
      ok('Заметки сохранены');
    });
    el.btnCopyNotes.addEventListener('click', () => {
      navigator.clipboard.writeText(el.notes.value || '').then(()=>ok('Скопировано'));
    });
    el.btnClearNotes.addEventListener('click', () => {
      el.notes.value = ''; localStorage.setItem('luxtasks.notes',''); ok('Заметки очищены');
    });
    document.addEventListener('keydown', (e) => {
      if ((e.ctrlKey || e.metaKey) && e.key.toLowerCase() === 'k') {
        e.preventDefault(); el.search.focus();
      }
    });

    // Логика
    function onAdd(){
      const title = (el.title.value || '').trim();
      if (!title) { warn('Введите заголовок'); return; }
      const priority = el.priority.value;
      const tags = (el.tags.value || '').split(',').map(t => t.trim()).filter(Boolean);

      tasks.push({
        id: cryptoRandom(),
        title, priority, tags,
        createdAt: new Date().toISOString(),
        done: false
      });
      el.title.value = ''; el.tags.value = '';
      saveTasks(); render(); ok('Добавлено');
    }

    function render(){
      const term = (el.search.value || '').trim().toLowerCase();
      const pr = el.filterPriority.value;

      const filtered = tasks.filter(t => {
        const text = (t.title + ' ' + t.tags.join(' ')).toLowerCase();
        const match = !term || text.includes(term);
        const prMatch = pr === 'all' || t.priority === pr;
        return match && prMatch;
      });

      // Статистика
      el.statTotal.textContent = tasks.length;
      el.statDone.textContent = tasks.filter(t => t.done).length;
      el.statHigh.textContent = tasks.filter(t => t.priority === 'high' && !t.done).length;

      // Рендер списка
      el.list.innerHTML = '';
      if (!filtered.length) {
        const empty = document.createElement('div');
        empty.className = 'chip';
        empty.textContent = 'Нет задач по текущему фильтру';
        el.list.appendChild(empty);
        return;
      }

      filtered
        .sort((a,b)=>{
          // Сортировка: невыполненные выше, затем приоритет high/medium/low, потом дата
          const doneDiff = (a.done === b.done) ? 0 : (a.done ? 1 : -1);
          if (doneDiff !== 0) return doneDiff;
          const pOrder = { high:0, medium:1, low:2 };
          const prDiff = pOrder[a.priority] - pOrder[b.priority];
          if (prDiff !== 0) return prDiff;
          return new Date(a.createdAt) - new Date(b.createdAt);
        })
        .forEach(task => {
          const row = document.createElement('div');
          row.className = 'item' + (task.done ? ' done' : '');
          row.dataset.id = task.id;

          // Левая зона: заголовок + теги + inline edit
          const left = document.createElement('div');
          const title = document.createElement('input');
          title.className = 'inline-edit item-title';
          title.value = task.title;
          title.title = 'Кликните, чтобы отредактировать заголовок';
          title.addEventListener('change', () => {
            const v = title.value.trim(); if (!v) return;
            task.title = v; saveTasks(); ok('Обновлено');
          });

          const meta = document.createElement('div');
          meta.className = 'item-meta';
          meta.textContent = task.tags.length ? '#' + task.tags.join(' #') : '—';

          left.appendChild(title);
          left.appendChild(meta);

          // Средняя зона: приоритет
          const pri = document.createElement('div');
          pri.className = 'priority ' + task.priority;
          pri.textContent = task.priority === 'high' ? 'Высокий' :
                            task.priority === 'medium' ? 'Средний' : 'Низкий';
          pri.title = 'Кликните, чтобы сменить приоритет';
          pri.style.cursor = 'pointer';
          pri.addEventListener('click', () => {
            task.priority = nextPriority(task.priority);
            saveTasks(); render();
          });

          // Правая зона: кнопки
          const actions = document.createElement('div');
          actions.className = 'item-actions';

          const btnDone = document.createElement('button');
          btnDone.className = 'btn';
          btnDone.textContent = task.done ? 'Вернуть' : 'Готово';
          btnDone.addEventListener('click', () => {
            task.done = !task.done; saveTasks(); render();
          });

          const btnEditTags = document.createElement('button');
          btnEditTags.className = 'btn';
          btnEditTags.textContent = 'Теги';
          btnEditTags.addEventListener('click', () => {
            const v = prompt('Теги через запятую', task.tags.join(', '));
            if (v !== null) {
              task.tags = v.split(',').map(s=>s.trim()).filter(Boolean);
              saveTasks(); render(); ok('Теги обновлены');
            }
          });

          const btnDel = document.createElement('button');
          btnDel.className = 'btn';
          btnDel.textContent = 'Удалить';
          btnDel.addEventListener('click', () => {
            if (confirm('Удалить задачу?')) {
              tasks = tasks.filter(x => x.id !== task.id);
              saveTasks(); render(); warn('Удалено');
            }
          });

          actions.appendChild(btnDone);
          actions.appendChild(btnEditTags);
          actions.appendChild(btnDel);

          row.appendChild(left);
          row.appendChild(pri);
          row.appendChild(actions);

          el.list.appendChild(row);
        });
    }

    function onExport(){
      const payload = JSON.stringify({ tasks, notes: el.notes.value }, null, 2);
      const blob = new Blob([payload], { type:'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url; a.download = 'LuxTasks.json';
      a.click();
      URL.revokeObjectURL(url);
      ok('Экспортировано в JSON');
    }

    function onImport(){
      const input = document.createElement('input');
      input.type = 'file'; input.accept = 'application/json';
      input.onchange = () => {
        const file = input.files[0]; if (!file) return;
        const reader = new FileReader();
        reader.onload = () => {
          try {
            const data = JSON.parse(reader.result);
            tasks = Array.isArray(data.tasks) ? data.tasks : [];
            el.notes.value = data.notes || '';
            localStorage.setItem('luxtasks.notes', el.notes.value);
            saveTasks(); render(); ok('Импорт завершён');
          } catch(e){
            warn('Ошибка импорта: неверный формат');
          }
        };
        reader.readAsText(file);
      };
      input.click();
    }

    function onClear(){
      if (!confirm('Очистить всё?')) return;
      tasks = []; saveTasks(); render();
      el.notes.value = ''; localStorage.setItem('luxtasks.notes','');
      warn('Данные очищены');
    }

    function saveTasks(){
      localStorage.setItem(storeKey, JSON.stringify(tasks));
    }

    function loadTasks(){
      try {
        const v = localStorage.getItem(storeKey);
        return v ? JSON.parse(v) : [];
      } catch {
        return [];
      }
    }

    function nextPriority(p){
      return p === 'low' ? 'medium' : p === 'medium' ? 'high' : 'low';
    }

    function cryptoRandom(){
      const arr = new Uint32Array(4);
      (window.crypto || window.msCrypto).getRandomValues(arr);
      return [...arr].map(x => x.toString(16)).join('');
    }

    function ok(msg){ setStatus(msg, 'ok'); }
    function warn(msg){ setStatus(msg, 'warn'); }
    function setStatus(msg, type){
      el.status.textContent = msg;
      el.status.style.color = type === 'ok' ? '#9dd79f' : '#ffb4b4';
      clearTimeout(setStatus._t);
      setStatus._t = setTimeout(()=> {
        el.status.textContent = 'Готово';
        el.status.style.color = '';
      }, 2000);
    }
  </script>
</body>
</html>
