<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Recount Tycoon</title>
  <style>
    body { font-family: Inter, sans-serif; margin: 0; padding: 0; background: #fff; color: #333; }
    header { background: #f5f5f5; padding: 20px; text-align: center; border-bottom: 1px solid #ddd; }
    .stats { font-size: 18px; margin-top: 10px; }
    section { padding: 20px; }
    h2 { margin-bottom: 10px; font-size: 20px; }
    .card { background: #f0f0f0; padding: 15px; margin: 10px 0; border-radius: 8px; cursor: pointer; transition: background 0.2s; font-size: 16px; }
    .card:hover { background: #e0e0e0; }
    button { margin: 5px; padding: 10px 20px; font-size: 16px; background: #333; color: #fff; border: none; border-radius: 6px; cursor: pointer; }
    button:hover { background: #555; }
    .log { background: #fafafa; border-top: 1px solid #ddd; padding: 20px; font-size: 14px; }
    #log div { margin-bottom: 5px; }
    @media (max-width: 600px) {
      .card { font-size: 15px; padding: 12px; }
      .stats { font-size: 16px; }
      button { font-size: 15px; padding: 8px 16px; }
    }
  </style>
</head>
<body>
  <header>
    <h1>Recount Tycoon</h1>
    <div class="stats">
      💰 <span id="budget">10000</span> ⏱ <span id="time">0</span> 👥 <span id="team">1</span> 📈 <span id="reputation">50</span> 🏢 <span id="level">1</span>
    </div>
    <button onclick="saveGame()">💾 Сохранить</button>
    <button onclick="loadGame()">📂 Загрузить</button>
  </header>

  <section class="features">
    <h2>Фичи продукта</h2>
    <div class="card" onclick="addFeature('pdf')">📄 PDF-парсинг — 3000</div>
    <div class="card" onclick="addFeature('rls')">🔐 RLS — 4000</div>
    <div class="card" onclick="addFeature('mobile')">📱 Мобильная адаптация — 2500</div>
    <div class="card" onclick="addFeature('api')">🔗 Интеграции — 3500</div>
    <div class="card" onclick="addFeature('analytics')">📊 Аналитика — 2000</div>
  </section>

  <section class="upgrades">
    <h2>Улучшения фич</h2>
    <div class="card" onclick="upgradeFeature('pdf')">📄 PDF → AI — 4000</div>
    <div class="card" onclick="upgradeFeature('rls')">🔐 RLS → Аудит — 5000</div>
    <div class="card" onclick="upgradeFeature('mobile')">📱 Моб → Кроссплатф. — 3500</div>
    <div class="card" onclick="upgradeFeature('api')">🔗 API → Webhooks — 4500</div>
    <div class="card" onclick="upgradeFeature('analytics')">📊 Аналитика → Дашборды — 3000</div>
  </section>

  <section class="team">
    <h2>Команда</h2>
    <div class="card" onclick="hire('designer')">🎨 UX-дизайнер — 2000</div>
    <div class="card" onclick="hire('dev')">💻 Разработчик — 3000</div>
    <div class="card" onclick="hire('lawyer')">⚖️ Юрист — 2500</div>
    <div class="card" onclick="hire('analyst')">📈 Аналитик — 1500</div>
  </section>

  <section class="office">
    <h2>Офис</h2>
    <div class="card" onclick="buildFloor('design')">🎨 Этаж дизайна — 3000</div>
    <div class="card" onclick="buildFloor('dev')">💻 Этаж разработки — 3000</div>
    <div class="card" onclick="buildFloor('legal')">⚖️ Этаж юристов — 3000</div>
    <div class="card" onclick="buildFloor('analytics')">📊 Этаж аналитики — 3000</div>
  </section>

  <section class="clients">
    <h2>Запросы клиентов</h2>
    <div id="client-request" class="card">—</div>
    <button onclick="respondToClient(true)">Принять</button>
    <button onclick="respondToClient(false)">Отклонить</button>
    <button onclick="nextTurn()">Следующий ход</button>
  </section>

  <section class="businesses">
    <h2>Бизнесы</h2>
    <div id="business-list"></div>
  </section>

  <section class="log">
    <h2>События</h2>
    <div id="log"></div>
  </section>

  <script>
    let budget = 10000, time = 0, team = 1, reputation = 50, level = 1;
    let features = [], featureLevels = { pdf: 1, rls: 1, mobile: 1, api: 1, analytics: 1 };
    let office = { design: false, dev: false, legal: false, analytics: false };
    let currentClient = null;

    function updateStats() {
      budget = Math.max(0, budget);
      reputation = Math.max(0, reputation);
      document.getElementById("budget").textContent = budget;
      document.getElementById("time").textContent = time;
      document.getElementById("team").textContent = team;
      document.getElementById("reputation").textContent = reputation;
      document.getElementById("level").textContent = level;
    }

    function log(message) {
      const entry = document.createElement("div");
      entry.textContent = `⏱ ${time}: ${message}`;
      document.getElementById("log").prepend(entry);
    }

    function addFeature(name) {
      const costs = { pdf: 3000, rls: 4000, mobile: 2500, api: 3500, analytics: 2000 };
      if (budget >= costs[name] && !features.includes(name)) {
        budget -= costs[name];
        features.push(name);
        time++;
        log(`✅ Внедрена фича: ${name.toUpperCase()}`);
        updateStats(); checkLevelUp();
      } else {
        log("Недостаточно бюджета или фича уже внедрена.");
      }
    }

    function upgradeFeature(name) {
      const cost = 2000 + featureLevels[name] * 1000;
      if (budget >= cost && featureLevels[name] < 2) {
        budget -= cost;
        featureLevels[name]++;
        time++;
        log(`🔧 Фича ${name.toUpperCase()} улучшена до уровня ${featureLevels[name]}`);
        updateStats();
      } else {
        log("Нельзя улучшить: либо нет бюджета, либо уже максимальный уровень.");
      }
    }

    function hire(role) {
      const costs = { designer: 2000, dev: 3000, lawyer: 2500, analyst: 1500 };
      if (budget >= costs[role]) {
        budget -= costs[role];
        team++;
        time++;
        log(`👥 Нанят: ${role}`);
        updateStats();
      } else {
        log("Недостаточно бюджета для найма.");
      }
    }

    function buildFloor(floor) {
      const cost = 3000;
      if (budget >= cost && !office[floor]) {
        budget -= cost;
        office[floor] = true;
        time++;
        log(`🏢 Построен этаж: ${floor}`);
        updateStats();
      } else {
        log("Этаж уже построен или недостаточно бюджета.");
      }
    }

    const clientRequests = [
      { text: "Нужна интеграция с 1С", need: "api+", reward: 1200 },
      { text: "Хочу авто-заполнение из PDF", need: "pdf+", reward: 1500 },
      { text: "Нужна RLS с разграничением по ролям", need: "rls+", reward: 1800 },
      { text: "Приложение должно работать на Android и iOS", need: "mobile+", reward: 1600 },
      { text: "Хочу дашборды и прогнозы", need: "analytics+", reward: 1400 }
    ];

    function triggerClientRequest() {
      currentClient = clientRequests[Math.floor(Math.random() * clientRequests.length)];
      document.getElementById("client-request").textContent = `💬 ${currentClient.text}`;
    }

    function respondToClient(accept) {
      if (!currentClient) return;
      if (accept) {
        const key = currentClient.need.replace("+", "");
        if (featureLevels[key] >= 2) {
          budget += currentClient.reward;
          reputation += 5;
          log(`📦 Запрос выполнен: +${currentClient.reward} и +5 репутации`);
        } else {
          log("❌ Запрос провален: фича не улучшена");
          reputation -= 5;
        }
      } else {
        log("🚫 Запрос отклонён");
        reputation -= 2;
      }
      currentClient = null;
      document.getElementById("client-request").textContent = "—";
      updateStats();
    }

    function paySalaries() {
      const salary = team * 500;
      budget -= salary;
      log(`💸 Зарплата команде: -${salary}`);
    }

    function earnSubscriptions() {
      const income = reputation * 20;
      budget += income;
      log(`📈 Подписки от клиентов: +${income}`);
    }

    function checkLevelUp() {
      if (reputation >= 60 && level === 1) {
        level = 2;
        log("📊 Уровень 2: открыты новые бизнесы");
      }
      if (reputation >= 80 && level === 2) {
        level = 3;
        log("🏆 Уровень 3: доступ к Красное & Белое");
      }
    }

    const businesses = [
      { name: "🛒 Потерочка", need: ["pdf", "mobile"], team: 1, reward: 1500, rep: 5 },
      { name: "🧃 Магнитик", need: ["pdf", "rls", "designer"], team: 2, reward: 3000, rep: 8 },
      { name: "🧻 Ашанчик", need: ["pdf", "api", "analytics"], team: 3, reward: 4000, rep: 10 },
      { name: "🧴 Метроша", need: ["pdf", "rls", "mobile", "api", "analytics"], team: 4, reward: 6000, rep: 15 },
      { name: "🍷 Красное & Белое", need: ["pdf", "rls", "mobile", "api", "analytics"], team: 5, reward: 7000, rep: 20 }
    ];

    function renderBusinesses() {
      const container = document.getElementById("business-list");
      container.innerHTML = "";
      businesses.forEach(biz => {
        const div = document.createElement("div");
        div.className = "card";
        div.textContent = `${biz.name} — ${biz.reward}`;
        div.onclick = () => deploy(biz);
        container.appendChild(div);
      });
    }

    function deploy(biz) {
      const hasAll = biz.need.every(f => features.includes(f) || f === "designer" && team >= 2);
      if (hasAll && team >= biz.team) {
        budget += biz.reward;
        reputation += biz.rep;
        time++;
        log(`🚀 Внедрение в ${biz.name}: +${biz.reward}, +${biz.rep} репутации`);
        updateStats();
        checkLevelUp();
        if (biz.name.includes("Красное") && reputation >= 100) {
          log("🎉 Победа! RecountPro внедрён в Красное & Белое!");
        }
      } else {
        log(`❌ Не хватает фич или команды для ${biz.name}`);
      }
    }

    function nextTurn() {
      time++;
      paySalaries();
      earnSubscriptions();
      if (time % 3 === 0) triggerClientRequest();
      updateStats();
    }

    function saveGame() {
      const state = {
        budget, time, team, reputation, level, features, featureLevels, office
      };
      localStorage.setItem("recountSave", JSON.stringify(state));
      log("💾 Игра сохранена");
    }

    function loadGame() {
      const state = JSON.parse(localStorage.getItem("recountSave"));
      if (state) {
        budget = state.budget;
        time = state.time;
        team = state.team;
        reputation = state.reputation;
        level = state.level;
        features = state.features;
        featureLevels = state.featureLevels;
        office = state.office;
        updateStats();
        log("📂 Игра загружена");
      } else {
        log("❌ Нет сохранения");
      }
    }

    renderBusinesses();
    updateStats();
  </script>
</body>
</html>
